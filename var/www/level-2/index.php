<?php

	class MyDB extends SQLite3 {
	    function __construct() {
		$this->enableExceptions(true);
		$this->open(':memory:');
	    }
	}

	$db = new MyDB();

	$db->exec('CREATE TABLE users (username STRING, password STRING)');
	$db->exec("INSERT INTO users (username, password) VALUES ('admin', '874hvkdv038h')");

	if( $_POST ) {
		$query = "SELECT `username`, `password` FROM users WHERE `username` = '" . $_POST['username'] . "' AND `password` = '" . $_POST['password'] . "'";
		try {
			$result = $db->query($query);
			$row = $result->fetchArray(SQLITE3_ASSOC);
		}
		catch(Exception $e) {
			print '<div style="color: #F00;"><strong>ERROR</strong><br/>';
			print $e->getMessage() . '<br/>';
			print $query . '<br/>';
			print '</div>';
		}
	}
?><!doctype html>
<html>
	<head>
		<title>This one should be easy.</title>
	</head>
	<body>
		<?php
			if( $_POST ) {
				if( is_array($row) ) {
		?>
		<h1>Nice!</h1>
<pre>Username: level3
Password: QqZrZSwTtFeDSZ1arpbx</pre>
                <p><a href="/level-3/">Level 3</a></p>
		<hr/>
		<?php
				}
				else {
		?>
		<p>Sorry, that is not the right password for user: <?php echo $_POST['username']; ?></p>
		<?php
				}
			}
		?>
		
		<h2>Unlock Level 3</h2>

		<form method="POST">
			<label for="username">Username</label><br/>
			<input type="text" name="username" value="<?php echo $_POST['username']; ?>" /><br/>
			<label for="password">Password</label><br/>
			<input type="password" name="password" /><br/>
			<input type="submit" value="Log In" />
		</form>
	</body>
</html>
